<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>New Challenger ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†</title>
<style>
/* --- CSS: ãƒ‡ã‚¶ã‚¤ãƒ³èª¿æ•´ --- */
body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    margin:0; 
    padding:0; 
    background:#f2f3f5; /* èƒŒæ™¯è‰²ã‚’è½ã¡ç€ã„ãŸç™½ã«è¿‘ã„ã‚°ãƒ¬ãƒ¼ã« */
    color:#2c3e50; /* æ–‡å­—è‰²ã‚’æ¿ƒã„ãƒã‚¤ãƒ“ãƒ¼ã« */
}
header { 
    background:#e74c3c; /* ãƒ˜ãƒƒãƒ€ãƒ¼è‰²ã‚’å¼·èª¿è‰²ï¼ˆèµ¤ç³»ï¼‰ã« */
    color:#fff; 
    text-align:center; 
    padding:15px 0; 
    font-size:1.6em; 
    font-weight:700; 
    box-shadow:0 3px 6px rgba(0,0,0,0.1); 
}
section { 
    margin:16px auto; 
    padding:0 8px;
    max-width: 800px; /* PCã§ã®è¦‹ã‚„ã™ã•ã®ãŸã‚æœ€å¤§å¹…ã‚’è¨­å®š */
}
h2 { 
    font-size:1.3em; 
    margin-bottom:10px; 
    border-bottom:2px solid #bdc3c7; /* è¦‹å‡ºã—ã®ä¸‹ç·š */
    padding-bottom:5px;
    color:#34495e; 
    font-weight:600;
}
h3 {
    font-size:1.1em;
    margin-top: 15px;
    margin-bottom: 5px;
    color: #8e44ad; /* æ˜å¾Œæ—¥ä»¥é™ã®æ—¥ä»˜ã‚’è¦‹ã‚„ã™ã */
}

/* ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒˆ */
.event-list { 
    list-style:none; 
    padding:0; 
    margin:0; 
}
.event-item { 
    background:#fff; 
    margin-bottom:8px; 
    padding:12px 15px; 
    border-radius:8px; 
    box-shadow:0 2px 4px rgba(0,0,0,0.08); 
    display:flex; 
    justify-content:space-between; 
    align-items:center; 
    font-size:1em; 
    transition: all 0.2s ease-in-out;
}
.event-item.upcoming { 
    border-left:6px solid #e74c3c; /* èµ¤è‰²ã®ãƒ©ã‚¤ãƒ³ã§æœªã‚¯ãƒªã‚¢å¼·èª¿ */
}

/* ã‚¤ãƒ™ãƒ³ãƒˆæ™‚åˆ» */
.event-time { 
    font-weight:bold; 
    margin-right:15px; 
    color:#2980b9; /* æ™‚åˆ»ã‚’é’è‰²ã«ã—ã¦ç›®ç«‹ãŸã›ã‚‹ */
    flex-shrink: 0; /* ç¸®ã¾ãªã„ã‚ˆã†ã« */
    min-width: 100px;
}
.event-name {
    flex-grow: 1;
}

/* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ */
.check { 
    transform:scale(1.4); 
    cursor:pointer; 
    margin-left: 10px;
    flex-shrink: 0;
}

/* ãƒœã‚¿ãƒ³é¡ */
.button-group {
    display: flex;
    gap: 8px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}
button { 
    padding:8px 15px; 
    border:none; 
    border-radius:5px; 
    cursor:pointer; 
    background:#3498db; /* ãƒœã‚¿ãƒ³ã‚’é’è‰²ã«çµ±ä¸€ */
    color:#fff; 
    font-weight:600;
    transition: background 0.2s;
}
button:hover {
    background:#2980b9;
}
#update-url { background:#e67e22; } /* åæ˜ ãƒœã‚¿ãƒ³ã‚’ã‚ªãƒ¬ãƒ³ã‚¸ç³»ã« */
#update-url:hover { background:#d35400; }

/* ã‚¯ãƒªã‚¢æ¸ˆã¿ãƒªã‚¹ãƒˆ */
#cleared-list { 
    display:none; 
    margin-top:10px; 
    padding: 10px;
    background: #ecf0f1;
    border-radius: 5px;
}
#cleared-list .event-item {
    background: #bdc3c7;
    padding: 8px 10px;
    font-size: 0.9em;
    border-left: 4px solid #7f8c8d;
}
#cleared-list .remove {
    background: #c0392b;
    color: #fff;
    padding: 2px 8px;
    font-size: 0.8em;
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media(max-width:600px){ 
    .event-item { font-size:0.9em; padding:10px; } 
    .event-time { margin-right:8px; min-width: 80px; } 
    .button-group button { font-size: 0.9em; padding: 6px 10px; }
}
</style>
</head>
<body>

<header>New Challenger ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†</header>

<section>
  <div class="button-group">
    <button id="update-url">âœ… ã‚¯ãƒªã‚¢ã‚’åæ˜ ãƒ»URLæ›´æ–°</button>
    <button id="copy-url">ğŸ”— URLã‚’ã‚³ãƒ”ãƒ¼</button>
    <button id="show-cleared">ã‚¯ãƒªã‚¢æ¸ˆã¿ã‚’è¦‹ã‚‹</button>
  </div>
  <div id="cleared-list"></div>
</section>

<section>
  <h2>æœ¬æ—¥ã®æœªã‚¯ãƒªã‚¢ã‚¤ãƒ™ãƒ³ãƒˆ</h2>
  <ul id="today" class="event-list"></ul>
</section>

<section>
  <h2>æ˜æ—¥ã®æœªã‚¯ãƒªã‚¢ã‚¤ãƒ™ãƒ³ãƒˆ</h2>
  <ul id="tomorrow" class="event-list"></ul>
</section>

<section>
  <h2>æ˜å¾Œæ—¥ä»¥é™ã®æœªã‚¯ãƒªã‚¢ã‚¤ãƒ™ãƒ³ãƒˆ</h2>
  <div id="future"></div>
</section>

<script>
// ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿: 2æ™‚é–“ã‚¹ãƒ‘ãƒ³ã‚’æƒ³å®š
const events =[
  {name: "VSãƒªãƒ¥ã‚¦ åˆç´š", times:["2025-10-05T12:00","2025-10-06T03:00","2025-10-11T18:00","2025-10-13T12:00","2025-10-17T00:00","2025-10-19T12:00","2025-10-20T03:00"]},
  {name: "VSãƒªãƒ¥ã‚¦ æ¿€ãƒ ã‚º", times:["2025-10-04T18:00","2025-10-06T12:00","2025-10-10T12:00","2025-10-12T00:00","2025-10-13T21:00","2025-10-18T18:00"]},
  {name: "VSæ˜¥éº— åˆç´š", times:["2025-10-05T12:00","2025-10-07T12:00","2025-10-11T18:00","2025-10-14T21:00","2025-10-17T00:00","2025-10-19T12:00"]},
  {name: "VSæ˜¥éº— æ¿€ãƒ ã‚º", times:["2025-10-04T18:00","2025-10-07T03:00","2025-10-10T12:00","2025-10-12T00:00","2025-10-14T06:00","2025-10-18T18:00"]},
  {name: "VSã‚¬ã‚¤ãƒ« åˆç´š", times:["2025-10-05T18:00","2025-10-08T03:00","2025-10-11T12:00","2025-10-15T12:00","2025-10-17T06:00","2025-10-19T18:00"]},
  {name: "VSã‚¬ã‚¤ãƒ« æ¿€ãƒ ã‚º", times:["2025-10-04T12:00","2025-10-08T12:00","2025-10-10T18:00","2025-10-12T06:00","2025-10-15T03:00","2025-10-18T12:00"]},
  {name: "VSã‚¶ãƒ³ã‚®ã‚¨ãƒ• åˆç´š", times:["2025-10-05T18:00","2025-10-09T12:00","2025-10-11T12:00","2025-10-16T21:00","2025-10-17T06:00","2025-10-19T18:00"]},
  {name: "VSã‚¶ãƒ³ã‚®ã‚¨ãƒ• æ¿€ãƒ ã‚º", times:["2025-10-04T12:00","2025-10-09T03:00","2025-10-10T18:00","2025-10-12T06:00","2025-10-16T06:00","2025-10-18T12:00"]},
  {name: "VSãƒ–ãƒ©ãƒ³ã‚« åˆç´š", times:["2025-10-03T12:00","2025-10-05T00:00","2025-10-06T15:00","2025-10-11T06:00","2025-10-13T00:00","2025-10-17T12:00","2025-10-19T00:00"]},
  {name: "VSãƒ–ãƒ©ãƒ³ã‚« æ¿€ãƒ ã‚º", times:["2025-10-04T06:00","2025-10-06T06:00","2025-10-10T00:00","2025-10-12T12:00","2025-10-13T09:00","2025-10-18T06:00","2025-10-20T06:00"]},
  {name: "VSãƒ€ãƒ«ã‚·ãƒ  åˆç´š", times:["2025-10-03T12:00","2025-10-05T00:00","2025-10-07T00:00","2025-10-11T06:00","2025-10-14T15:00","2025-10-17T12:00","2025-10-19T00:00"]},
  {name: "VSãƒ€ãƒ«ã‚·ãƒ  æ¿€ãƒ ã‚º", times:["2025-10-04T06:00","2025-10-07T15:00","2025-10-10T00:00","2025-10-12T12:00","2025-10-14T00:00","2025-10-18T06:00"]},
  {name: "VSã‚±ãƒ³ åˆç´š", times:["2025-10-03T18:00","2025-10-05T06:00","2025-10-08T09:00","2025-10-11T00:00","2025-10-15T00:00","2025-10-17T18:00","2025-10-19T06:00"]},
  {name: "VSã‚±ãƒ³ æ¿€ãƒ ã‚º", times:["2025-10-04T00:00","2025-10-08T18:00","2025-10-10T06:00","2025-10-12T18:00","2025-10-15T21:00","2025-10-18T00:00"]},
  {name: "VSã‚¨ãƒ‰ãƒ¢ãƒ³ãƒ‰æœ¬ç”° åˆç´š", times:["2025-10-03T18:00","2025-10-05T06:00","2025-10-09T00:00","2025-10-11T00:00","2025-10-16T15:00","2025-10-17T18:00","2025-10-19T06:00"]},
  {name: "VSã‚¨ãƒ‰ãƒ¢ãƒ³ãƒ‰æœ¬ç”° æ¿€ãƒ ã‚º", times:["2025-10-04T00:00","2025-10-09T15:00","2025-10-10T06:00","2025-10-12T18:00","2025-10-16T00:00","2025-10-18T00:00"]},
  {name: "VSãƒã‚¤ã‚½ãƒ³ ä¸­ç´š", times:["2025-10-04T21:00","2025-10-06T09:00","2025-10-10T03:00","2025-10-12T15:00","2025-10-13T18:00","2025-10-18T21:00"]},
  {name: "VSãƒã‚¤ã‚½ãƒ³ è¶…æ¿€ãƒ ã‚º", times:["2025-10-05T15:00","2025-10-06T18:00","2025-10-11T21:00","2025-10-13T03:00","2025-10-17T03:00","2025-10-19T15:00","2025-10-20T00:00"]},
  {name: "VSãƒãƒ«ãƒ­ã‚° ä¸­ç´š", times:["2025-10-04T21:00","2025-10-07T18:00","2025-10-10T03:00","2025-10-12T15:00","2025-10-14T03:00","2025-10-18T21:00"]},
  {name: "VSãƒãƒ«ãƒ­ã‚° è¶…æ¿€ãƒ ã‚º", times:["2025-10-05T15:00","2025-10-07T09:00","2025-10-11T21:00","2025-10-14T12:00","2025-10-17T03:00","2025-10-19T15:00"]},
  {name: "VSã‚µã‚¬ãƒƒãƒˆ ä¸­ç´š", times:["2025-10-04T15:00","2025-10-08T21:00","2025-10-10T09:00","2025-10-12T21:00","2025-10-15T06:00","2025-10-18T15:00"]},
  {name: "VSã‚µã‚¬ãƒƒãƒˆ è¶…æ¿€ãƒ ã‚º", times:["2025-10-05T21:00","2025-10-08T06:00","2025-10-11T15:00","2025-10-15T15:00","2025-10-17T09:00","2025-10-19T21:00"]},
  {name: "VSãƒ™ã‚¬ ä¸­ç´š", times:["2025-10-04T15:00","2025-10-09T06:00","2025-10-10T09:00","2025-10-12T21:00","2025-10-16T03:00","2025-10-18T15:00"]},
  {name: "VSãƒ™ã‚¬ è¶…æ¿€ãƒ ã‚º", times:["2025-10-05T21:00","2025-10-09T21:00","2025-10-11T15:00","2025-10-16T12:00","2025-10-17T09:00","2025-10-19T21:00"]},
  {name: "VSã•ãã‚‰ åˆç´š", times:["2025-10-04T09:00","2025-10-08T15:00","2025-10-10T15:00","2025-10-12T03:00","2025-10-15T18:00","2025-10-18T09:00"]},
  {name: "VSã•ãã‚‰ æ¿€ãƒ ã‚º", times:["2025-10-03T15:00","2025-10-05T03:00","2025-10-08T00:00","2025-10-11T09:00","2025-10-15T09:00","2025-10-17T15:00","2025-10-19T03:00"]},
  {name: "VSãƒ«ãƒ¼ã‚¯ åˆç´š", times:["2025-10-04T09:00","2025-10-09T18:00","2025-10-10T15:00","2025-10-12T03:00","2025-10-16T09:00","2025-10-18T09:00"]},
  {name: "VSãƒ«ãƒ¼ã‚¯ æ¿€ãƒ ã‚º", times:["2025-10-03T15:00","2025-10-05T03:00","2025-10-09T09:00","2025-10-11T09:00","2025-10-16T18:00","2025-10-17T15:00","2025-10-19T03:00"]},
  {name: "VSã‚­ãƒ£ãƒŸã‚£ åˆç´š", times:["2025-10-04T03:00","2025-10-06T21:00","2025-10-10T21:00","2025-10-12T09:00","2025-10-13T06:00","2025-10-18T03:00","2025-10-20T09:00"]},
  {name: "VSã‚­ãƒ£ãƒŸã‚£ æ¿€ãƒ ã‚º", times:["2025-10-03T21:00","2025-10-05T09:00","2025-10-06T00:00","2025-10-11T03:00","2025-10-13T15:00","2025-10-17T21:00","2025-10-19T09:00"]},
  {name: "VSã‚¸ãƒ¥ãƒª åˆç´š", times:["2025-10-04T03:00","2025-10-07T06:00","2025-10-10T21:00","2025-10-12T09:00","2025-10-14T09:00","2025-10-18T03:00"]},
  {name: "VSã‚¸ãƒ¥ãƒª æ¿€ãƒ ã‚º", times:["2025-10-03T21:00","2025-10-05T09:00","2025-10-07T21:00","2025-10-11T03:00","2025-10-14T18:00","2025-10-17T21:00","2025-10-19T09:00"]}
];

// ã‚¤ãƒ™ãƒ³ãƒˆã®é–‹å‚¬æ™‚é–“ã‚’2æ™‚é–“ã¨ä»®å®š (VSãƒã‚¤ã‚½ãƒ³ãƒ»ãƒãƒ«ãƒ­ã‚°ãƒ»ã‚µã‚¬ãƒƒãƒˆãƒ»ãƒ™ã‚¬ã¯3æ™‚é–“ã¨ä»®å®š)
const DURATION_MS = 2 * 60 * 60 * 1000; 

// --- ã‚¯ãƒªã‚¢æ¸ˆã¿ç®¡ç†ï¼ˆURLã‹ã‚‰ï¼‰ ---
let urlParams = new URLSearchParams(window.location.search);
let clearedStages = urlParams.get("cleared") ? urlParams.get("cleared").split(",") : [];

// --- DOMå‚ç…§ ---
const todayEl = document.getElementById("today");
const tomorrowEl = document.getElementById("tomorrow");
const futureEl = document.getElementById("future");
const clearedEl = document.getElementById("cleared-list");

// JST (+09:00) ã® Date ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç¢ºå®Ÿã«ç”Ÿæˆ
function getJstTime(timeStr) {
  // Tå½¢å¼ã®æ™‚åˆ»ã«Zã‚’ä»˜åŠ ã—ã€UTCã¨ã—ã¦è§£é‡ˆã•ã›ã‚‹ã“ã¨ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®å½±éŸ¿ã‚’å›é¿
  return new Date(timeStr + "Z"); 
}

/**
 * 9æ™‚åŸºæº–ã§æ™‚åˆ»dãŒå±ã™ã‚‹ã€Œæ—¥ã€ã‚’ YYYY-MM-DD å½¢å¼ã§è¿”ã™
 * @param {Date} dt - JSTã¨ã—ã¦è§£é‡ˆã•ã‚ŒãŸDateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 * @returns {string} YYYY-MM-DDå½¢å¼ã®æ—¥ä»˜æ–‡å­—åˆ—
 */
function getJstDateString(dt) {
  const JST_OFFSET_HOURS = 0;
  
  // UTCã®æ™‚åˆ»ã‚’9æ™‚é–“ãšã‚‰ã—ã¦ã€JST 9:00ã‚’æ—¥ä»˜ã®åŒºåˆ‡ã‚Šã¨ã™ã‚‹
  const baseDate = new Date(dt.getTime());
  baseDate.setUTCHours(baseDate.getUTCHours() - JST_OFFSET_HOURS);
  
  // YYYY-MM-DD å½¢å¼ã§å–å¾—
  return baseDate.toISOString().slice(0, 10);
}

/**
 * 9æ™‚åŸºæº–ã§2ã¤ã®æ™‚åˆ»ãŒåŒã˜æ—¥ã‹ã‚’åˆ¤å®š
 * @param {Date} d1 - åŸºæº–æ™‚åˆ»ï¼ˆJSTï¼‰
 * @param {Date} d2 - æ¯”è¼ƒæ™‚åˆ»ï¼ˆJSTï¼‰
 * @returns {boolean} åŒã˜æ—¥ãªã‚‰ true
 */
function isSameJstDay(d1, d2) {
    return getJstDateString(d1) === getJstDateString(d2);
}

// --- ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ  ---
function addEvent(el, name, timeStart, isUpcoming){
  // ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ï¼ˆã‚¯ãƒªã‚¢æ¸ˆã¿ï¼‰ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¯è¡¨ç¤ºã—ãªã„
  if(clearedStages.includes(name)) return; 
  
  const li = document.createElement("li");
  li.className = "event-item" + (isUpcoming ? " upcoming" : "");
  
  // çµ‚äº†æ™‚åˆ»ã®è¨ˆç®— (ã‚¤ãƒ™ãƒ³ãƒˆæ™‚é–“å¸¯ã®è¡¨ç¤º)
  let duration = DURATION_MS;
  if(name.includes("") || name.includes("") || name.includes("") || name.includes("")){
      duration = 3 * 60 * 60 * 1000; // è¶…æ¿€ãƒ ã‚ºã‚’å«ã‚€4ã‚­ãƒ£ãƒ©ã¯3æ™‚é–“ã¨ä»®å®š
  }
  const timeEnd = new Date(timeStart.getTime() + duration);
  
  const formatTime = (d) => d.getUTCHours().toString().padStart(2,'0') + ":" + d.getUTCMinutes().toString().padStart(2,'0');
  
  const timeText = formatTime(timeStart) + "ï½" + formatTime(timeEnd);
  
  li.innerHTML = `
    <span class="event-time">${timeText}</span>
    <span class="event-name">${name}</span>
    <input type="checkbox" class="check" data-event-name="${name}">
  `;

  // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã«ã‚¯ãƒªã‚¢ã‚¹ãƒ†ãƒ¼ã‚¸åã‚’è¨­å®š
  const checkbox = li.querySelector(".check");
  checkbox.checked = false; // æœªã‚¯ãƒªã‚¢ãƒªã‚¹ãƒˆãªã®ã§å¸¸ã«false

  // ãƒã‚§ãƒƒã‚¯ã¯å³åæ˜ ã›ãšã€åæ˜ ãƒœã‚¿ãƒ³ã§ URL æ›´æ–°
  checkbox.addEventListener("change", ()=>{});

  el.appendChild(li);
}

// --- ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ---
function render(){
  todayEl.innerHTML='<li class="event-item">æœ¬æ—¥é–‹å‚¬äºˆå®šã®æœªã‚¯ãƒªã‚¢ã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>'; 
  tomorrowEl.innerHTML='<li class="event-item">æ˜æ—¥é–‹å‚¬äºˆå®šã®æœªã‚¯ãƒªã‚¢ã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>'; 
  futureEl.innerHTML="";

  const nowJst = getJstTime(new Date().toISOString().slice(0, 16));
  const todayStr = getJstDateString(nowJst);
  
  // 9æ™‚åŸºæº–ã®ã€Œæ˜æ—¥ã€ã®Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆæ¯”è¼ƒç”¨ï¼‰
  const tomorrowJst = new Date(nowJst.getTime());
  tomorrowJst.setUTCDate(tomorrowJst.getUTCDate() + 1);
  const tomorrowStr = getJstDateString(tomorrowJst);


  // å…¨ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã—ã€æ—¥ä»˜ã§ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°
  let allEvents = [];
  events.forEach(ev => {
    ev.times.forEach(t => {
      const timeStart = getJstTime(t);
      // éå»ã®ã‚¤ãƒ™ãƒ³ãƒˆã€ã¾ãŸã¯ã‚¯ãƒªã‚¢æ¸ˆã¿ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¯é™¤å¤–
      if(timeStart.getTime() < nowJst.getTime() - DURATION_MS || clearedStages.includes(ev.name)) {
        return;
      }
      allEvents.push({name: ev.name, time: t, date: timeStart, dateStr: getJstDateString(timeStart)});
    });
  });

  // æ—¥ä»˜ã”ã¨ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’åˆ†é¡ã—ã€ã‚½ãƒ¼ãƒˆ
  let dateMap = {};
  allEvents.forEach(ev => {
    if(!dateMap[ev.dateStr]) dateMap[ev.dateStr] = [];
    dateMap[ev.dateStr].push(ev);
  });
  
  // ã‚½ãƒ¼ãƒˆå‡¦ç†: ç¾åœ¨æ™‚åˆ»ã«è¿‘ã„é †ï¼ˆæ™‚é–“ãŒå¤ã„é †ï¼‰ã«ã‚½ãƒ¼ãƒˆ
  // ä»Šæ—¥ã€æ˜æ—¥ã€æ˜å¾Œæ—¥ä»¥é™ã®ãƒªã‚¹ãƒˆã§ã‚‚ã“ã®ã‚½ãƒ¼ãƒˆãŒé©ç”¨ã•ã‚Œã‚‹
  Object.keys(dateMap).forEach(date => {
      dateMap[date].sort((a,b)=>a.date.getTime() - b.date.getTime());
  });


  let isTodayEmpty = true;
  let isTomorrowEmpty = true;

  // åˆ†é¡ã¨è¡¨ç¤º
  Object.keys(dateMap).sort().forEach(dateStr => {
      const eventList = dateMap[dateStr];
      const firstEventDate = eventList[0].date;

      let targetEl;
      
      if(dateStr === todayStr){
          // ä»Šæ—¥
          targetEl = todayEl;
          if(isTodayEmpty) targetEl.innerHTML = ""; // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’å‰Šé™¤
          isTodayEmpty = false;
      } else if (dateStr === tomorrowStr){
          // æ˜æ—¥
          targetEl = tomorrowEl;
          if(isTomorrowEmpty) targetEl.innerHTML = ""; // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’å‰Šé™¤
          isTomorrowEmpty = false;
      } else {
          // æ˜å¾Œæ—¥ä»¥é™
          targetEl = futureEl;

          const div = document.createElement("div");
          const title = document.createElement("h3");
          title.textContent = dateStr;
          div.appendChild(title);

          const ul = document.createElement("ul"); ul.className="event-list";
          
          eventList.forEach(ev=>addEvent(ul, ev.name, ev.date, true)); // æ˜å¾Œæ—¥ä»¥é™ã¯å…¨ã¦Upcoming
          
          div.appendChild(ul);
          futureEl.appendChild(div);
          return;
      }
      
      // ä»Šæ—¥ãƒ»æ˜æ—¥ã¯ ul ã«ç›´æ¥è¿½åŠ 
      eventList.forEach(ev=>{
          const isUpcoming = ev.date.getTime() >= nowJst.getTime();
          addEvent(targetEl, ev.name, ev.date, isUpcoming);
      });
  });

  renderClearedList();
}

// --- ã‚¯ãƒªã‚¢æ¸ˆã¿ãƒªã‚¹ãƒˆ ---
function renderClearedList(){
  clearedEl.innerHTML="";
  if(clearedStages.length===0){ 
    clearedEl.textContent="ãªã—"; 
    return;
  }
  const ul = document.createElement("ul"); ul.className="event-list";
  clearedStages.forEach(name=>{
    const li = document.createElement("li");
    li.className = "event-item";
    li.innerHTML = `${name} <button class="remove">Ã—</button>`;
    li.querySelector(".remove").addEventListener("click", ()=> {
      clearedStages = clearedStages.filter(x=>x!==name);
      // ã‚¯ãƒªã‚¢æ¸ˆã¿ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã—ãŸã‚‰ã€URLã‚’æ›´æ–°ã—ã¦å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ä¿ƒã™
      document.getElementById("update-url").click(); 
    });
    ul.appendChild(li);
  });
  clearedEl.appendChild(ul);
}

// --- ãƒœã‚¿ãƒ³ ---
document.getElementById("update-url").addEventListener("click", ()=> {
  const newCleared = [];
  
  // ä»Šè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹æœªã‚¯ãƒªã‚¢ãƒªã‚¹ãƒˆã§ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‚¹ãƒ†ãƒ¼ã‚¸åã‚’å–å¾—
  document.querySelectorAll(".check:checked").forEach(cb=>{
    const name = cb.getAttribute('data-event-name');
    if(name && !newCleared.includes(name)) newCleared.push(name);
  });
  
  // æ—¢å­˜ã®ã‚¯ãƒªã‚¢æ¸ˆã¿ã‚¹ãƒ†ãƒ¼ã‚¸ã¨ä»Šå›ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ãƒãƒ¼ã‚¸
  let updatedClearedStages = Array.from(new Set([...clearedStages, ...newCleared]));

  const params = new URLSearchParams();
  if(updatedClearedStages.length>0) {
    // å¸¸ã«ã‚½ãƒ¼ãƒˆã—ã¦URLã‚’ãã‚Œã„ã«ä¿ã¤
    updatedClearedStages.sort();
    params.set("cleared", updatedClearedStages.join(","));
  }
  
  // URLã®ã‚¯ãƒªã‚¢æ¸ˆã¿ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã€ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  window.location.search=params.toString();
});

document.getElementById("copy-url").addEventListener("click", ()=> {
  navigator.clipboard.writeText(window.location.href).then(()=>alert("ã‚¯ãƒªã‚¢çŠ¶æ³ã‚’ä¿å­˜ã—ãŸURLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"));
});

document.getElementById("show-cleared").addEventListener("click", (e)=> {
  const isHidden = clearedEl.style.display==="none" || clearedEl.style.display==="";
  clearedEl.style.display = isHidden ? "block" : "none";
  e.target.textContent = isHidden ? 'ğŸ™ˆ ã‚¯ãƒªã‚¢æ¸ˆã¿ã‚’éš ã™' : 'ğŸ‘ï¸ ã‚¯ãƒªã‚¢æ¸ˆã¿ã‚’è¦‹ã‚‹';
});

// åˆå›å®Ÿè¡Œ
render();
</script>
</body>
</html>
